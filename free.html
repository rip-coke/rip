---
layout: page
permalink: /free
---
<script type="module">
  const form = document.querySelector('form');

  const counties = [
    ['Nairobi', 'Nairobi'],
    ['Mombasa', 'Mombasa'],
    ['Machakos', 'Machakos'],
    ['Uasin Gishu', 'Uasin Gishu'],
    ['Kiambu', 'Kiambu'],
    ['Kwale', 'Kwale'],
    ['Kilifi', 'Kilifi'],
    ['Tana River', 'Tana River'],
    ['Lamu', 'Lamu'],
    ['Taita/Taveta', 'Taita/Taveta'],
    ['Garissa', 'Garissa'],
    ['Wajir', 'Wajir'],
    ['Mandera', 'Mandera'],
    ['Marsabit', 'Marsabit'],
    ['Isiolo', 'Isiolo'],
    ['Meru', 'Meru'],
    ['Tharaka-Nithi', 'Tharaka-Nithi'],
    ['Embu', 'Embu'],
    ['Kitui', 'Kitui'],
    ['Makueni', 'Makueni'],
    ['Nyandarua', 'Nyandarua'],
    ['Nyeri', 'Nyeri'],
    ['Kirinyaga', 'Kirinyaga'],
    ["Murang'a", "Murang'a"],
    ['Turkana', 'Turkana'],
    ['West Pokot', 'West Pokot'],
    ['Samburu', 'Samburu'],
    ['Trans Nzoia', 'Trans Nzoia'],
    ['Elgeyo/Marakwet', 'Elgeyo/Marakwet'],
    ['Nandi', 'Nandi'],
    ['Baringo', 'Baringo'],
    ['Laikipia', 'Laikipia'],
    ['Nakuru', 'Nakuru'],
    ['Narok', 'Narok'],
    ['Kajiado', 'Kajiado'],
    ['Kericho', 'Kericho'],
    ['Bomet', 'Bomet'],
    ['Kakamega', 'Kakamega'],
    ['Vihiga', 'Vihiga'],
    ['Bungoma', 'Bungoma'],
    ['Busia', 'Busia'],
    ['Siaya', 'Siaya'],
    ['Kisumu', 'Kisumu'],
    ['Homa Bay', 'Homa Bay'],
    ['Migori', 'Migori'],
    ['Kisii', 'Kisii'],
    ['Nyamira', 'Nyamira']
  ];

  // Populate county <select> with options
  (function populateCounties(){
    const select = document.querySelector('select#county');
    if (!select) return;
    // optional placeholder
    const placeholder = document.createElement('option');
    placeholder.value = "";
    placeholder.textContent = "Select county";
    placeholder.disabled = true;
    placeholder.selected = true;
    select.appendChild(placeholder);

    counties.forEach(([value, label]) => {
      const opt = document.createElement('option');
      opt.value = value;
      opt.textContent = label;
      select.appendChild(opt);
    });
  })();

  // Send a POST to Formspree
  async function sendToFormspree(formEl) {
    try {
      // create a fresh FormData from the form element (so it can be reused elsewhere)
      const fsData = new FormData(formEl);
      fsData.delete('attachment');
      fsData.delete('message');
      const resp = await fetch('https://formspree.io/f/xwpoeark', {
        method: 'POST',
        body: fsData,
        headers: { 'Accept': 'application/json' }
      });
      const json = await resp.json().catch(()=>null);
      return { ok: resp.ok, status: resp.status, json };
    } catch (err) {
      return { ok: false, error: err };
    }
  }

  form.addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent default form submission

    const formData = new FormData(form); // gathers file input and other form fields
    const status = document.getElementById("obituaryFormStatus");

    fetch('https://admin.rip.ke/upload', {
      method: 'POST',
      body: formData
    })
    .then(response => { console.log('response'); console.log(response) })
    .then(data => { console.log('data'); console.log(data) })
    .then(info => { console.log('info1'); status.innerHTML = `Thank you for choosing Rip.ke to commemorate your loved one. A message with the obituary link will be sent to you shortly.` })
    .then(info =>  { console.log('info2'); form.style.display = "none" })
    // also submit a copy to Formspree for email notifications/logging
    .finally(() => {
      sendToFormspree(form).then(res => {
        if (res.ok) {
          console.log('Formspree success', res);
        } else {
          console.error('Formspree error', res);
        }
      });
    })
    .catch(error => { console.log('error'); console.error(error) }) 
  });

</script>

<div id="content" class="bg-white pb-6 sm:pb-6 text-center">
  <div class="mx-auto flex justify-center">
    <section class="w-full bg-white rounded-lg shadow-lg p-8">
      <h1 class="text-2xl font-bold mb-6 text-gray-800 text-center">Free Obituary Request</h1>
      <p id="obituaryFormStatus" class="pb-8">Please give us some contact details so we can send you the published link and submit your obituary. Thank you for choosing Rip.ke to commemorate your loved one.</p>
      <form class="space-y-6" id="obituaryForm" action="" method="POST" enctype="multipart/form-data">
        <input 
          type="hidden" 
          name="url"
          id="url"
        />
        <div>
          <label for="name" class="block text-gray-700 font-medium mb-2">Your Name</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
        </div>
        <div>
          <label for="email" class="block text-gray-700 font-medium mb-2">Your Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            pattern="^[^@\s]+@[^@\s]+\.[^@\s]+$"
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
          <p id="emailError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid email address.</p>
        </div>
        <div>
          <label for="phone" class="block text-gray-700 font-medium mb-2">Your Phone Number</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            pattern="^\+?\d{10,15}$"
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
          <p id="phoneError" class="text-red-500 text-sm mt-1 hidden">Please enter a valid phone number (10-15 digits).</p>
        </div>

        <div>
          <label for="name" class="block text-gray-700 font-medium mb-2">Obituary Name</label>
          <input
            type="text"
            id="name_obit"
            name="name_obit"
            required
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
        </div>   
        <div>
          <label for="county" class="block text-gray-700 font-medium mb-2">Obituary County</label>
          <select id="county" name="county" class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
          </select>
        </div>       
        <div>
          <label for="dod" class="block text-gray-700 font-medium mb-2">Obituary Date</label>
          <input
            type="date"
            id="dod"
            name="dod"
            required
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
        </div>        
        <div>
          <label for="dob" class="block text-gray-700 font-medium mb-2">Obituary Birth Date</label>
          <input
            type="date"
            id="dob"
            name="dob"
            required
            class="max-w-md px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"
          />
        </div>        
        <div>
          <label for="message" class="block text-gray-700 font-medium mb-2">Obituary</label>
          <textarea
            id="message"
            name="message"
            rows="6"
            class="max-w-md w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500 resize-vertical"
            placeholder="Write a short obituary or message..."
          ></textarea>
        </div>

        <div>
          <label for="attachment" class="block text-gray-700 font-medium mb-2">Upload a photo (optional)</label>
          <input
            type="file"
            id="attachment"
            name="attachment"
            accept="image/*"
            class="max-w-md w-full text-sm text-gray-700"
          />
          <p id="fileName" class="text-sm text-gray-600 mt-2"></p>
          
        </div>

        <button
          id="paystackJouralistBtn"
          class="max-w-md py-2 px-4 bg-yellow-500 text-white font-semibold rounded-md hover:bg-yellow-600 transition-colors"
          type="submit"
        >
          Submit
        </button>
      </form>
    </section>
  </div>
</div>

<script>
  let emailTimeout, phoneTimeout;

  // Email validation on keyup with timeout
  document.getElementById('email').addEventListener('keyup', function() {
    clearTimeout(emailTimeout);
    emailTimeout = setTimeout(() => {
      const email = this.value;
      const emailError = document.getElementById('emailError');
      const emailPattern = /^[^@\s]+@[^@\s]+\.[^@\s]+$/;
      if (!emailPattern.test(email)) {
        emailError.classList.remove('hidden');
      } else {
        emailError.classList.add('hidden');
      }
    }, 400);
  });

  // Phone validation on keyup with timeout
  document.getElementById('phone').addEventListener('keyup', function() {
    clearTimeout(phoneTimeout);
    phoneTimeout = setTimeout(() => {
      const phone = this.value;
      const phoneError = document.getElementById('phoneError');
      const phonePattern = /^\+?\d{10,15}$/;
      if (!phonePattern.test(phone)) {
        phoneError.classList.remove('hidden');
      } else {
        phoneError.classList.add('hidden');
      }
    }, 400);
  });

  document.getElementById("url").value = window.location.href;
</script>
